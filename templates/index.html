{% extends "base.html" %}

{% block content %}
  <style>
    /* Ненавязчивая геро-секция и акцент на кнопке */
    .hero {
      border-radius: 1rem;
      padding: 1.25rem 1.5rem;
      background: linear-gradient(135deg, rgba(25,135,84,0.08), rgba(13,110,253,0.06));
      border: 1px solid rgba(0,0,0,.075);
    }
    .kpi {
      border-radius: 1rem;
      padding: .9rem 1rem;
      border: 1px solid rgba(0,0,0,.08);
    }
    .kpi h3 {
      margin: 0;
      font-size: 1.5rem;
      line-height: 1.1;
    }
    .kpi small {
      opacity: .8;
    }
    @media (min-width: 992px) {
      .kpi h3 { font-size: 1.75rem; }
    }
  </style>

  <div class="hero mb-4">
    <div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-between gap-3">
      <div>
        <h2 class="mb-1">Сведения о базе данных</h2>
        <div class="text-muted">Актуальные показатели и состояние каталога устройств</div>
      </div>

      <!-- Главная CTA-кнопка -->
      <a href="{{ url_for('add_device') }}"
         class="btn btn-success btn-lg px-4 py-2"
         aria-label="Добавить новое устройство в базу">
        ＋ Добавить устройство
      </a>
    </div>
  </div>

  <!-- Сводные KPI карточки -->
  <div class="row g-3">
    <div class="col-6 col-md-4 col-lg-3">
      <div class="kpi h-100">
        <small class="d-block text-muted">Устройства, всего</small>
        <h3>{{ totals['devices'] }}</h3>
      </div>
    </div>
    <div class="col-6 col-md-4 col-lg-3">
      <div class="kpi h-100">
        <small class="d-block text-muted">Категории</small>
        <h3>{{ totals['categories'] }}</h3>
      </div>
    </div>
    <div class="col-6 col-md-4 col-lg-3">
      <div class="kpi h-100">
        <small class="d-block text-muted">Производители</small>
        <h3>{{ totals['manufacturers'] }}</h3>
      </div>
    </div>
    <div class="col-6 col-md-4 col-lg-3">
      <div class="kpi h-100">
        <small class="d-block text-muted">Продавцы</small>
        <h3>{{ totals['retailers'] }}</h3>
      </div>
    </div>
    <div class="col-6 col-md-4 col-lg-3">
      <div class="kpi h-100">
        <small class="d-block text-muted">Устройств в наличии*</small>
        <h3>{{ in_stock_devices }}</h3>
      </div>
    </div>
    <div class="col-6 col-md-4 col-lg-3">
      <div class="kpi h-100">
        <small class="d-block text-muted">Предложений продавцов</small>
        <h3>{{ offers_total }}</h3>
      </div>
    </div>
  </div>

  <!-- Расширенная таблица (читаемо на одном экране) -->
  <div class="card shadow-sm mt-4">
    <div class="card-body">
      <h5 class="card-title mb-3">Расширенная статистика</h5>
      <div class="table-responsive">
        <table class="table table-sm table-bordered align-middle mb-0 w-auto">
          <tbody>
            <tr>
              <th class="text-nowrap">Диапазон цен</th>
              <td class="text-nowrap">{{ price_min }} — {{ price_avg }} — {{ price_max }}</td>
              <td class="text-muted">мин — средняя — макс</td>
            </tr>
            <tr>
              <th class="text-nowrap">Диапазон дат релиза</th>
              <td class="text-nowrap">{{ release_min }} — {{ release_max }}</td>
              <td></td>
            </tr>
            <tr>
              <th class="text-nowrap">Последнее обновление цен</th>
              <td class="text-nowrap">{{ last_update or 'нет данных' }}</td>
              <td></td>
            </tr>
            <tr>
              <th class="text-nowrap">Размер файла БД</th>
              <td class="text-nowrap">
                {% if db_size_mb is not none %}~{{ db_size_mb }} МБ{% else %}—{% endif %}
              </td>
              <td></td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="form-text mt-2">* Устройства, имеющиеся в наличии хотя бы у одного продавца</div>
    </div>
  </div>
  <div class="card shadow-sm mt-4">
    <div class="card-body">
      <h5 class="card-title mb-3">Таблицы базы данных</h5>
      <div class="table-responsive">
        <table class="table table-sm table-striped align-middle text-center">
          <thead>
            <tr>
              <th>Название таблицы</th>
              <th>Что содержит</th>
              <th>Количество элементов</th>
              <th>Количество атрибутов</th>
              <th>Назначение</th>
            </tr>
          </thead>
          <tbody>
            {% for t in tables_info %}
              <tr>
                <td class="text-nowrap">{{ t.name }}</td>
                <td class="text-start">{{ t.rus }}</td>
                <td>{{ t.rows }}</td>
                <td>{{ t.columns }}</td>
                <td class="text-nowrap">{{ t.purpose }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="form-text">
        Назначение: <strong>главная</strong> — основная сущность (устройства),
        <strong>справочник</strong> — классификаторы и списки,
        <strong>дополнительная</strong> — детализация и связующие таблицы.
      </div>
    </div>
  </div>

{% endblock %}
